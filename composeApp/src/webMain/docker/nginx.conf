server {
    listen 80;

    root /usr/share/nginx/html;
    index index.html;

    # .mjs files are ES modules used by Skiko â€” browsers reject them without the correct MIME type.
    # A `types` block at the server level would override ALL default MIME types from the http level,
    # so we use a location block instead to only affect .mjs files.
    location ~* \.mjs$ {
        default_type application/javascript;
    }

    # HTML should never be cached so the browser always fetches the latest entry point
    location ~* \.html$ {
        add_header Cache-Control "no-cache";
    }

    # JS, Wasm and other assets: cache but revalidate on every request using etag
    location ~* \.(js|mjs|wasm|css|png|jpg|svg|ico)$ {
        add_header Cache-Control "no-cache";
        try_files $uri =404;
    }

    # SPA fallback: serve index.html for all paths so client-side routing works
    location / {
        add_header Cache-Control "no-cache";
        try_files $uri $uri/ /index.html;
    }

    # Wasm and JS assets are large; gzip cuts transfer size significantly
    gzip on;
    gzip_types application/javascript application/wasm;
}